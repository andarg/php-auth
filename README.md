## Подключение модуля

1. Подключить модуль в composer.json

2. выполнить composer update

3. Регистрируем роутинг для админки и страниц регистрации и авторизации: добавить в точку входа сайта строку

    \OLOG\Auth\RegisterRoutes::registerRoutes();

4. Добавляем в конфиг сайта базу данных с идентификатором DB_NAME_PHPAUTH и указать для нее файл sql ...

5. Выполнить cli.php в корне сайта чтобы создать таблицы для пользователей и записи пермишенов

После этого админка авторизации должна заработать по адресу /admin/auth

Изначально она будет недоступна, потому что нет ни одного пользователя, который имел бы к ней доступ. Чтобы создать такого пользователя - активируем доступ по куки:

Добавим в конфиг сайта такой ключ:

    $conf['php_auth'] = [
        'full_access_cookie_name' => 'jkhbsdfhjvkdfvjgvasdc'
    ];

Здесь нужно указать любое случайное имя куки, которая будет давать полный доступ в админку авторизации.

После этого в браузере вешаем на главную страницу сайта куку с таким именем. Например, можно в консоли хрома выполнить такую команду:

    document.cookie="jkhbsdfhjvkdfvjgvasdc=1"

После этого можно зайти на /admin/auth

Там создать пользователя с логином и паролем, оператора для него и дать оператору разрешения на управление пользователями и операторами.

После завершения настройки ключ с кукой из конфига надо обазательно убрать! Теперь можно авторизоваться под только что созданным пользователем на странице /auth/login и работать.

Замечание: сейчас для хранения сессий используется только мемкеш, поэтому на компе должен быть рабочий мемкеш и в конфиге должна быть настройка такого вида:

    $conf['memcache_servers'] = [
        'localhost:11211'
    ];

## Создание нового разрешения в другом модуле

1. Создаем константу в классе Модуль/Permissions (название класса можно использовать любое, это просто удобное соглашение)

Имя константы примерно такое: PERMISSION_MODULENAME_MANAGE_NODES где MODULENAME - имя вашего модуля, а MANAGE_NODES - пример названия собственно разрешения.

Эта константа нужна для использования в коде для проверки разрешений.

2. Имя разрешения надо вставить в таблицу разрешений: руками добавить sql-запрос в файл sql-запросов модуля. Вот пример:

    'insert into olog_auth_permission (title) values ("PERMISSION_MODULENAME_MANAGE_NODES") /* 364563456 */;',

Запись в таблице будет использоваться админкой для назначения разрешений операторам.
